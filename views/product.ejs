<%- include ("./navigation", {userName : userName}) %>
  <!-- <%= product %> -->

  <div class="product">
    <div class="product_section">
      <div class="product_section_image">
        <div class="img_container">
          <img src=<%=product.featuredImage %> alt="" />
        </div>
      </div>
      <div class="product_section_content">
        <div class="right-column">
          <!-- Product Description -->
          <div class="product-description">
            <!-- <span>Pendants</span> -->
            <h1>
              <%= product.productName %>
            </h1>
            <span>
              <%= product.price %> $
            </span>
            <p>
              <%= product.description %>
            </p>
            <form class="cart" action="<%=`/user/addToCart/${product._id}`%>" method="post">
              <div class="quantity">
                <label class="screen-reader-text" for="<%= `quantity_${product._id}` %>">quantity</label>
                <span class="quantity-minus" onclick="decreaseQuantity('<%= `quantity_${product._id}` %>')"></span>
                <input type="text" id="<%= `quantity_${product._id}` %>" class="input-text" name="quantity" value="1"
                  size="4" data-min="1" data-max="" data-step="1" placeholder="" inputmode="numeric"
                  autocomplete="off" />
                <span class="quantity-plus" onclick="increaseQuantity('<%= `quantity_${product._id}` %>')"></span>
              </div>
              <button type="submit" name="add-to-cart" value="1293" class="single_add_to_cart_button button alt">
                <div class="text">Add to cart</div>
              </button>
            </form>
            <div class="product-wishlist-share">
              <a onclick="updateWishlist(`<%= product._id %>`)" class="wishlist" id="<%=`wishlist_${product._id}`%>"
                href="<%=`/user/addToWishlist/${product._id}`%>" target=<%=`uploader_iframe_${product._id}`%>>
                <%if(Boolean(product.isWishlisted)){%>
                  <i class="zmdi zmdi-favorite"></i>
                  <span class="text">Added to Wishlist</span>
                  <%}else{%>
                    <i class="zmdi zmdi-favorite-outline"></i>
                    <span class="text">Add to Wishlist</span>
                    <%}%>
              </a>
              <iframe id='<%=`uploader_iframe_${product._id}` %>' name='<%= `uploader_iframe_${product._id}`
                  %>'></iframe>
              <div class="share">
                <div class="text">Share:</div>
                <span class="material-symbols-outlined icon"> share </span>
                <ul>
                  <a class="whatsapp" onclick="share()" target="_blank">
                    <i class="zmdi zmdi-whatsapp"></i>
                  </a>
                  <a class="copy" onclick="copy()">
                    <i class="zmdi zmdi-copy"></i>
                  </a>
                </ul>
              </div>
            </div>
          </div>

          <div class="product-specs">
            <div class="item">
              <div class="key">Count In Stock </div>
              <div class="value">: <%= product.countInStock %>
              </div>
            </div>
            <div class="item">
              <div class="key">Weight (in gms) </div>
              <div class="value">: <%= product.weight %>
              </div>
            </div>
            <div class="item">
              <div class="key">Length (in cms) </div>
              <div class="value">: <%= product.length %>
              </div>
            </div>
            <div class="item">
              <div class="key">Metal Description </div>
              <div class="value">: <%= product.metalDescription %>
              </div>
            </div>
            <div class="item">
              <div class="key">Silver Purity </div>
              <div class="value">: <%= product.purity %>
              </div>
            </div>
            <div class="item">
              <div class="key">Product Warranty </div>
              <div class="value">: <%= product.warranty %>
              </div>
            </div>
            <div class="item">
              <div class="key">Stones Description </div>
              <div class="value">: <%= product.stones %>
              </div>
            </div>
          </div>
          <div class="delivery-check">
            <form action="" class="check-delivery">
              <input type="number" name="pincode" id="pincode" placeholder="Enter pincode" />
              <button class="submit-check-delivery">Check Availability</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="additional-info">
      <div class="product-additional-info">
        <div class="switcher">
          <button id="description" class="description underline_animation_active" onclick="openDescriptionTab()">
            Description
          </button>
          <button id="delivery" class="delivery" onclick="openDeliveryTab()">
            Delivery
          </button>
          <button id="reviews" class="reviews" onclick="openReviewsTab()">
            Reviews
          </button>
        </div>
      </div>
      <div id="description-content" class="info-content">
        <div class="description-content-left">
          <h3>About Design</h3>
          <p class="design-details">
            This gorgeous sterling silver chain, one of our outstanding featured
            picks, belongs in every person's unique jewellery collection.
            Beautiful and elegant 925 sterling silver beaded box chain.
            <br />
            The chain's superior construction offers maximum flexibility and
            resilience, making it particularly appropriate for hanging pendants.
          </p>
          <p class="stock-update">Yayy!! In stock</p>
        </div>
        <div class="description-content-right">
          <h4>SUMMER COLLECTION</h4>
          <p>
            Lorem Ipsum estibulum blandit libero at mauris condimentum
            scelerisque. In scelerisque in mauris ut malesuada. Nam sodales
            scelerisque ipsum sed vestib.
          </p>

          <h5>PEARL INTUITION</h5>
          <p>
            Nam sodales scelerisque ipsum sed vestibulum aliquam euismod mi vitae
            nibh.
          </p>
        </div>
      </div>
      <div id="delivery-content" class="info-content">
        <div class="description-content-left">
          <h4>Returns policy</h4>
          <p>
            You may return most new, unopened items within 7 days of delivery for
            a full refund. We'll also pay the return shipping costs if the return
            is a result of our error (you received an incorrect or defective item,
            etc.).
          </p>
          <p>
            You should expect to receive your refund within four weeks of giving
            your package to the return shipper, however, in many cases you will
            receive a refund more quickly. This time period includes the transit
            time for us to receive your return from the shipper (5 to 10 business
            days), the time it takes us to process your return once we receive it
            (3 to 5 business days), and the time it takes your bank to process our
            refund request (5 to 10 business days).
          </p>
        </div>
        <div class="description-content-right">
          <h4>shipping Policy</h4>
          <p>
            We can ship to virtually any address in the world. Note that there are
            restrictions on some products, and some products cannot be shipped to
            international destinations.
          </p>
          <p>
            When you place an order, we will estimate shipping and delivery dates
            for you based on the availability of your items and the shipping
            options you choose. Depending on the shipping provider you choose,
            shipping date estimates may appear on the shipping quotes page.
          </p>
        </div>
      </div>
      <div id="reviews-content" class="info-content">
        <h4>1 REVIEW FOR FLAT EARRINGS</h4>
        <div class="reviews-box">
          <div class="review">
            <div class="r-img-cont">
              <img src="/assets/images/payal1.jpeg" alt="" />
            </div>
            <div class="r-details">
              <div class="stars">
                <?xml version="1.0" ?><svg class="test" baseProfile="tiny" height="24px" id="Layer_1" version="1.2"
                  viewBox="0 0 24 24" width="24px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
                  xmlns:xlink="http://www.w3.org/1999/xlink">
                  <g>
                    <g>
                      <path
                        d="M9.362,9.158c0,0-3.16,0.35-5.268,0.584c-0.19,0.023-0.358,0.15-0.421,0.343s0,0.394,0.14,0.521    c1.566,1.429,3.919,3.569,3.919,3.569c-0.002,0-0.646,3.113-1.074,5.19c-0.036,0.188,0.032,0.387,0.196,0.506    c0.163,0.119,0.373,0.121,0.538,0.028c1.844-1.048,4.606-2.624,4.606-2.624s2.763,1.576,4.604,2.625    c0.168,0.092,0.378,0.09,0.541-0.029c0.164-0.119,0.232-0.318,0.195-0.505c-0.428-2.078-1.071-5.191-1.071-5.191    s2.353-2.14,3.919-3.566c0.14-0.131,0.202-0.332,0.14-0.524s-0.23-0.319-0.42-0.341c-2.108-0.236-5.269-0.586-5.269-0.586    s-1.31-2.898-2.183-4.83c-0.082-0.173-0.254-0.294-0.456-0.294s-0.375,0.122-0.453,0.294C10.671,6.26,9.362,9.158,9.362,9.158z" />
                    </g>
                  </g>
                </svg>
                <?xml version="1.0" ?><svg baseProfile="tiny" height="24px" id="Layer_1" version="1.2"
                  viewBox="0 0 24 24" width="24px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
                  xmlns:xlink="http://www.w3.org/1999/xlink">
                  <g>
                    <g>
                      <path
                        d="M9.362,9.158c0,0-3.16,0.35-5.268,0.584c-0.19,0.023-0.358,0.15-0.421,0.343s0,0.394,0.14,0.521    c1.566,1.429,3.919,3.569,3.919,3.569c-0.002,0-0.646,3.113-1.074,5.19c-0.036,0.188,0.032,0.387,0.196,0.506    c0.163,0.119,0.373,0.121,0.538,0.028c1.844-1.048,4.606-2.624,4.606-2.624s2.763,1.576,4.604,2.625    c0.168,0.092,0.378,0.09,0.541-0.029c0.164-0.119,0.232-0.318,0.195-0.505c-0.428-2.078-1.071-5.191-1.071-5.191    s2.353-2.14,3.919-3.566c0.14-0.131,0.202-0.332,0.14-0.524s-0.23-0.319-0.42-0.341c-2.108-0.236-5.269-0.586-5.269-0.586    s-1.31-2.898-2.183-4.83c-0.082-0.173-0.254-0.294-0.456-0.294s-0.375,0.122-0.453,0.294C10.671,6.26,9.362,9.158,9.362,9.158z" />
                    </g>
                  </g>
                </svg>
                <?xml version="1.0" ?><svg baseProfile="tiny" height="24px" id="Layer_1" version="1.2"
                  viewBox="0 0 24 24" width="24px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
                  xmlns:xlink="http://www.w3.org/1999/xlink">
                  <g>
                    <g>
                      <path
                        d="M9.362,9.158c0,0-3.16,0.35-5.268,0.584c-0.19,0.023-0.358,0.15-0.421,0.343s0,0.394,0.14,0.521    c1.566,1.429,3.919,3.569,3.919,3.569c-0.002,0-0.646,3.113-1.074,5.19c-0.036,0.188,0.032,0.387,0.196,0.506    c0.163,0.119,0.373,0.121,0.538,0.028c1.844-1.048,4.606-2.624,4.606-2.624s2.763,1.576,4.604,2.625    c0.168,0.092,0.378,0.09,0.541-0.029c0.164-0.119,0.232-0.318,0.195-0.505c-0.428-2.078-1.071-5.191-1.071-5.191    s2.353-2.14,3.919-3.566c0.14-0.131,0.202-0.332,0.14-0.524s-0.23-0.319-0.42-0.341c-2.108-0.236-5.269-0.586-5.269-0.586    s-1.31-2.898-2.183-4.83c-0.082-0.173-0.254-0.294-0.456-0.294s-0.375,0.122-0.453,0.294C10.671,6.26,9.362,9.158,9.362,9.158z" />
                    </g>
                  </g>
                </svg>
                <?xml version="1.0" ?><svg baseProfile="tiny" height="24px" id="Layer_1" version="1.2"
                  viewBox="0 0 24 24" width="24px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
                  xmlns:xlink="http://www.w3.org/1999/xlink">
                  <g>
                    <g>
                      <path
                        d="M9.362,9.158c0,0-3.16,0.35-5.268,0.584c-0.19,0.023-0.358,0.15-0.421,0.343s0,0.394,0.14,0.521    c1.566,1.429,3.919,3.569,3.919,3.569c-0.002,0-0.646,3.113-1.074,5.19c-0.036,0.188,0.032,0.387,0.196,0.506    c0.163,0.119,0.373,0.121,0.538,0.028c1.844-1.048,4.606-2.624,4.606-2.624s2.763,1.576,4.604,2.625    c0.168,0.092,0.378,0.09,0.541-0.029c0.164-0.119,0.232-0.318,0.195-0.505c-0.428-2.078-1.071-5.191-1.071-5.191    s2.353-2.14,3.919-3.566c0.14-0.131,0.202-0.332,0.14-0.524s-0.23-0.319-0.42-0.341c-2.108-0.236-5.269-0.586-5.269-0.586    s-1.31-2.898-2.183-4.83c-0.082-0.173-0.254-0.294-0.456-0.294s-0.375,0.122-0.453,0.294C10.671,6.26,9.362,9.158,9.362,9.158z" />
                    </g>
                  </g>
                </svg>
                <?xml version="1.0" ?><svg baseProfile="tiny" height="24px" id="Layer_1" version="1.2"
                  viewBox="0 0 24 24" width="24px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
                  xmlns:xlink="http://www.w3.org/1999/xlink">
                  <g>
                    <g>
                      <path
                        d="M9.362,9.158c0,0-3.16,0.35-5.268,0.584c-0.19,0.023-0.358,0.15-0.421,0.343s0,0.394,0.14,0.521    c1.566,1.429,3.919,3.569,3.919,3.569c-0.002,0-0.646,3.113-1.074,5.19c-0.036,0.188,0.032,0.387,0.196,0.506    c0.163,0.119,0.373,0.121,0.538,0.028c1.844-1.048,4.606-2.624,4.606-2.624s2.763,1.576,4.604,2.625    c0.168,0.092,0.378,0.09,0.541-0.029c0.164-0.119,0.232-0.318,0.195-0.505c-0.428-2.078-1.071-5.191-1.071-5.191    s2.353-2.14,3.919-3.566c0.14-0.131,0.202-0.332,0.14-0.524s-0.23-0.319-0.42-0.341c-2.108-0.236-5.269-0.586-5.269-0.586    s-1.31-2.898-2.183-4.83c-0.082-0.173-0.254-0.294-0.456-0.294s-0.375,0.122-0.453,0.294C10.671,6.26,9.362,9.158,9.362,9.158z" />
                    </g>
                  </g>
                </svg>
              </div>
              <div class="name">Deeksha Sharma - 15 Sep 2023</div>
              <div class="text">
                Bulum blandit libero at mauris condimentum males uada scelerisque
                in mauris ut malesuada.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      var descriptionButton = document.getElementById("description");
      var deliveryButton = document.getElementById("delivery");
      var reviewsButton = document.getElementById("reviews");
      var descriptionContent = document.getElementById("description-content");
      var deliveryContent = document.getElementById("delivery-content");
      var reviewsContent = document.getElementById("reviews-content");

      function openDescriptionTab() {
        descriptionContent.style.opacity = 1;
        deliveryContent.style.opacity = 0;
        reviewsContent.style.opacity = 0;
        descriptionButton.classList.add("underline_animation_active");
        deliveryButton.classList.remove("underline_animation_active");
        reviewsButton.classList.remove("underline_animation_active");
      }

      function openDeliveryTab() {
        descriptionContent.style.opacity = 0;
        deliveryContent.style.opacity = 1;
        reviewsContent.style.opacity = 0;
        deliveryButton.classList.add("underline_animation_active");
        descriptionButton.classList.remove("underline_animation_active");
        reviewsButton.classList.remove("underline_animation_active");
      }

      function openReviewsTab() {
        descriptionContent.style.opacity = 0;
        deliveryContent.style.opacity = 0;
        reviewsContent.style.opacity = 1;
        reviewsButton.classList.add("underline_animation_active");
        descriptionButton.classList.remove("underline_animation_active");
        deliveryButton.classList.remove("underline_animation_active");
      }

      function decreaseQuantity(inputId) {
        const input = document.getElementById(inputId);
        const currentValue = parseInt(input.value, 10);
        const minValue = parseInt(input.getAttribute("data-min"), 10);

        if (currentValue > minValue) {
          input.value = currentValue - 1;
        }
      }

      function increaseQuantity(inputId) {
        const input = document.getElementById(inputId);
        const currentValue = parseInt(input.value, 10);
        const maxValue = parseInt(input.getAttribute("data-max"), 10);

        if (isNaN(maxValue) || currentValue < maxValue) {
          input.value = currentValue + 1;
        }
      }

      function checkIframeLoaded(id) {
        var iframe = document.getElementById(`uploader_iframe_${id}`);

        function onLoadHandler() {
          var iframeDoc = iframe.contentDocument || iframe.contentWindow.document;

          if (iframeDoc) {
            var preElement = iframeDoc.body.getElementsByTagName('pre')[0];

            if (preElement) {
              var response = preElement.innerHTML;
              console.log({ response });

              // Update your button or perform other actions based on the response
              updateButton(response, id);
            } else {
              console.error("Error: 'pre' element not found in iframe content.");
            }
          } else {
            console.error("Error: Unable to access iframe document.");
          }
        }

        if (iframe.readyState == 'complete') {
          onLoadHandler();
        } else {
          // Use the load event to ensure the content is fully loaded
          iframe.addEventListener('load', onLoadHandler);
        }
      }


      function updateButton(response, id) {
        const updateButton = document.getElementById(`wishlist_${id}`);
        updateButton.classList.remove('load');
        if (response === "true") {
          updateButton.innerHTML = `<i class="zmdi zmdi-favorite"></i><span class="text">Added to Wishlist</span>`
        } else if (response === "false") {
          updateButton.innerHTML = `<i class="zmdi zmdi-favorite-outline"></i><span class="text">Add to Wishlist</span>`
        }
      }

      function updateWishlist(id) {
        const updateButton = document.getElementById(`wishlist_${id}`);
        updateButton.classList.add('load');
        console.log({ id })
        checkIframeLoaded(id);
      }

      function share() {

        // Getting user input 
        var message = "hello";

        // Opening URL 
        window.open(
          "https://web.whatsapp.com/send?text=will add link",

          // This is what makes it  
          // open in a new window. 
          '_blank'
        );
      }

      function copy() {
        navigator.clipboard.writeText("copy link");
      }
    </script>
  </div>